{"version":3,"names":["ReadableStream","VertexAIErrorCode","VertexAIError","createEnhancedContentResponse","responseLineRE","processStream","response","inputStream","start","controller","reader","body","getReader","decoder","TextDecoder","done","value","read","close","decodedValue","decode","stream","enqueue","responseStream","getResponseStream","stream1","stream2","tee","generateResponseSequence","getResponsePromise","allResponses","enhancedResponse","aggregateResponses","push","currentText","pump","then","undefined","trim","error","PARSE_FAILED","match","parsedResponse","JSON","parse","_","substring","length","responses","lastResponse","aggregatedResponse","promptFeedback","candidates","candidate","i","index","citationMetadata","finishReason","finishMessage","safetyRatings","content","parts","role","newPart","part","text","functionCall","Object","keys"],"sourceRoot":"../../../lib","sources":["requests/stream-reader.ts"],"mappings":"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","ignoreList":[]}
