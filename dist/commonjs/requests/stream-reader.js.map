{"version":3,"names":["_webStreamsPolyfill","require","_index","_errors","_responseHelpers","responseLineRE","processStream","response","inputStream","ReadableStream","start","controller","reader","body","getReader","decoder","TextDecoder","done","value","read","close","decodedValue","decode","stream","enqueue","responseStream","getResponseStream","stream1","stream2","tee","generateResponseSequence","getResponsePromise","allResponses","enhancedResponse","createEnhancedContentResponse","aggregateResponses","push","currentText","pump","then","undefined","trim","error","VertexAIError","VertexAIErrorCode","PARSE_FAILED","match","parsedResponse","JSON","parse","_","substring","length","responses","lastResponse","aggregatedResponse","promptFeedback","candidates","candidate","i","index","citationMetadata","finishReason","finishMessage","safetyRatings","content","parts","role","newPart","part","text","functionCall","Object","keys"],"sourceRoot":"../../../lib","sources":["requests/stream-reader.ts"],"mappings":"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","ignoreList":[]}
